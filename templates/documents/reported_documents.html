{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Reported Documents</h2>
  {% if documents %}
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Title</th>
          <th>Uploader</th>
          <th>Reports</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for doc in documents %}
        <tr>
          <td>{{ doc.title }}</td>
          <td>{{ doc.uploaded_by.username }}</td>
          <td>
            <ul>
              {% for report in doc.reports %}
                <li>
                  <strong>{{ report.reason|capfirst }}</strong>
                  {% if report.comment %}: {{ report.comment }}{% endif %}
                  <br><small class="text-muted">by {{ report.reported_by }} on {{ report.reported_at|default:doc.uploaded_at }}</small>
                </li>
              {% endfor %}
            </ul>
          </td>
          <td>
            {% if doc.file %}
              <a href="{{ doc.file.url }}" class="btn btn-sm btn-outline-primary">Download</a>
            {% else %}
              <span class="text-muted">No file</span>
            {% endif %}
            
            <form method="post" action="{% url 'delete_document' doc.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn btn-sm btn-danger" onclick="return confirm('Delete this document?');">
                Delete
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No documents have been reported.</p>
  {% endif %}
</div>
{% endblock %}
